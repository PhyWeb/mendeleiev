<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placement de l'Hydrogène</title>
    <link rel="stylesheet" href="style.css">
    <script src="data.js"></script>
    <script src="game.js"></script>
</head>
<body>
    <header>
        <h2>Où placer l'Hydrogène ?</h2>
        <p>Etudiez ses propriétés pour lui trouver une position qui soit en accord avec les principes établis jusqu'ici (mais tous ces principes ne pourront pas être respectés car il est assez différent des autres).</p>
    </header>

    <div class="main-container">
        <section class="game-area">
            <div class="card-pool" id="pool" ondrop="drop(event)" ondragover="commonAllowDrop(event)" style="min-height:80px;"></div>
            <div class="periodic-grid" id="grid"></div>
        </section>

        <aside class="info-panel">
            <div class="info-header">
                <div id="info-symbole">--</div>
                <div id="info-nom">Survolez un élément</div>
            </div>
            
            <div class="info-item">
                <span class="info-label">Masse atomique (H=1)</span>
                <span id="info-masse" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Formule corps simple</span>
                <span id="info-formule" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Propriétés Physiques</span>
                <span id="info-propPhy" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Propriétés Chimiques</span>
                <span id="info-propChi" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Composés</span>
                <span id="info-composes" class="info-value"></span>
            </div>
        </aside>
    </div>

    <footer class="controls">
        <button class="btn" onclick="validerH()">Vérifier la position de H</button>
        <div id="message-box"></div>
        <div class="nav-links">
             <a href="index.html" id="btn-fin" class="btn" style="display:none;">Retour à l'accueil</a>
        </div>
    </footer>

    <script>
        const pool = document.getElementById('pool');
        const grid = document.getElementById('grid');

        // Création grille
        for(let i=0; i<32; i++) {
            let slot = document.createElement('div');
            slot.className = 'slot';
            slot.setAttribute('data-index', i);
            slot.ondrop = drop; 
            slot.ondragover = commonAllowDrop;
            grid.appendChild(slot);
        }

        // Init
        elementsData.forEach(el => {
            if(el.id === "H") {
                // Pour l'Hydrogène, on utilise la Factory (il est draggable et interactif)
                const hCard = createCard(el, true);
                pool.appendChild(hCard);
            } else {
                // Pour les autres, création manuelle "simplifiée" (non interactifs, grisés)
                let card = document.createElement('div');
                card.className = 'element-card';
                card.id = el.id;
                
                // Conteneur pour le symbole
                const symboleSpan = document.createElement('span');
                symboleSpan.textContent = el.id;
                card.appendChild(symboleSpan);
                
                // Ajout de la masse sous le symbole
                const masseDiv = document.createElement('div');
                masseDiv.className = 'element-mass';
                masseDiv.textContent = `m = ${el.masse}`;
                card.appendChild(masseDiv);
                
                // Styles spécifiques "désactivé"
                card.style.backgroundColor = "#eee";
                card.style.color = "#888";
                card.style.borderColor = "#ccc";
                
                let slot = grid.querySelector(`.slot[data-index='${el.pos}']`);
                if(slot) slot.appendChild(card);
            }
        });

        // Afficher automatiquement les infos de H au chargement
        showInfo("H");

        function drop(ev) {
            ev.preventDefault();
            let data = ev.dataTransfer.getData("text");
            // Seul H est autorisé à bouger sur cette page
            if(data !== "H") return; 
            
            let el = document.getElementById(data);
            if(ev.target.classList.contains('slot') && ev.target.children.length === 0) {
                ev.target.appendChild(el);
            } else if (ev.target.id === 'pool') pool.appendChild(el);
        }

        function validerH() {
            let hCard = document.getElementById("H");
            if(!hCard) {
                document.getElementById('message-box').innerHTML = "Erreur : carte H introuvable.";
                return;
            }
            
            let parent = hCard.parentElement;
            let msg = document.getElementById('message-box');

            if(parent.classList.contains('slot')) {
                let idx = parseInt(parent.getAttribute('data-index'));
                if(idx === 0) {
                    hCard.className = "element-card correct";
                    msg.innerHTML = "Bravo ! H est dans la colonne 1.";
                    msg.className = "msg-success";
                    document.getElementById('btn-fin').style.display = 'inline-block';
                } else if (idx === 6 || idx === 14) {
                     hCard.className = "element-card incorrect";
                     msg.innerHTML = "Pas bête (famille 7), mais Mendeleïev a privilégié la masse.";
                     msg.className = "msg-partial";
                } else {
                    hCard.className = "element-card incorrect";
                    msg.innerHTML = "Vous n'avez pas su placer correctement l'élément H. Prenez en compte sa masse atomique et ses propriétés, <strong>principalement</strong> les formules de ses corps composés.";
                    msg.className = "msg-error";
                }
            } else {
                msg.innerHTML = "Placez l'Hydrogène dans la grille.";
                msg.className = "msg-error";
            }
        }
    </script>
</body>
</html>