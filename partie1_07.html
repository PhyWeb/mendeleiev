<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placement de l'Hydrogène</title>
    <link rel="stylesheet" href="style.css">
    <script src="data.js"></script>
    <script src="game.js"></script>
</head>
<body>
    <header>
        <h2>Où placer l'Hydrogène ?</h2>
        <p>Etudiez ses propriétés pour lui trouver une position qui soit en accord avec les principes établis jusqu'ici (mais tous ces principes ne pourront pas être respectés car il est assez différent des autres).</p>
    </header>

    <div class="main-container">
        <section class="game-area">
            <div class="card-pool" id="pool" ondrop="handleCardDrop(event)" ondragover="commonAllowDrop(event)" style="min-height:80px;"></div>
            <div class="periodic-grid" id="grid"></div>
        </section>

        <aside class="info-panel">
            <div class="info-header">
                <div id="info-symbole">--</div>
                <div id="info-nom">Survolez un élément</div>
            </div>
            
            <div class="info-item">
                <span class="info-label">Masse atomique (H=1)</span>
                <span id="info-masse" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Formule corps simple</span>
                <span id="info-formule" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Propriétés Physiques</span>
                <span id="info-propPhy" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Propriétés Chimiques</span>
                <span id="info-propChi" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Composés</span>
                <span id="info-composes" class="info-value"></span>
            </div>
        </aside>
    </div>

    <footer class="controls">
        <button class="btn" onclick="validerH()">Vérifier la position de H</button>
        <div id="message-box"></div>
        <div class="nav-links">
             <a href="index.html" id="btn-fin" class="btn" style="display:none;">Retour à l'accueil</a>
        </div>
    </footer>

    <script>
        const pool = document.getElementById('pool');
        const grid = document.getElementById('grid');

        // --- 1. CRÉATION DE LA GRILLE ---
        for(let i=0; i<32; i++) {
            let slot = document.createElement('div');
            slot.className = 'slot';
            slot.setAttribute('data-index', i);
            
            // On branche la logique centralisée de game.js
            slot.ondrop = handleCardDrop; 
            slot.ondragover = commonAllowDrop;
            
            grid.appendChild(slot);
        }

        // --- 2. INITIALISATION DES CARTES ---
        elementsData.forEach(el => {
            if(el.id === "H") {
                // Pour l'Hydrogène : carte interactive (draggable)
                // On l'ajoute au pool
                const hCard = createCard(el, true);
                pool.appendChild(hCard);
                
                // Afficher automatiquement les infos de H au démarrage
                showInfo("H");
            } else {
                // Pour les autres éléments : carte statique (non draggable)
                // createCard(data, isDraggable, options)
                const card = createCard(el, false);
                
                // Application du style "désactivé/fixe"
                // On surcharge les styles de base pour indiquer qu'ils ne bougent pas
                card.style.backgroundColor = "#eee";
                card.style.color = "#888";
                card.style.borderColor = "#ccc";
                card.style.cursor = "default"; // Curseur normal (pas de main)

                // Placement direct dans la grille à la position définie
                let slot = grid.querySelector(`.slot[data-index='${el.pos}']`);
                if(slot) slot.appendChild(card);
            }
        });

        // --- 3. VALIDATION (Logique pédagogique conservée) ---
        function validerH() {
            let hCard = document.getElementById("H");
            
            // Sécurité si la carte n'existe pas
            if(!hCard) return;
            
            let parent = hCard.parentElement;
            let msg = document.getElementById('message-box');

            // Vérification de la position
            if(parent.classList.contains('slot')) {
                let idx = parseInt(parent.getAttribute('data-index'));
                
                // Cas 1 : Correct (Colonne 1)
                if(idx === 0) {
                    hCard.className = "element-card correct";
                    msg.innerHTML = "Bravo ! H est dans la colonne 1.";
                    msg.className = "msg-success";
                    document.getElementById('btn-fin').style.display = 'inline-block';
                } 
                // Cas 2 : Erreur "intelligente" (Colonne 7 - Halogènes)
                // Les indices 6 et 14 correspondent à la colonne 7 dans cette grille
                else if (idx === 6 || idx === 14) {
                     hCard.className = "element-card incorrect";
                     msg.innerHTML = "Pas bête (famille 7), mais Mendeleïev a privilégié la masse.";
                     msg.className = "msg-partial"; // Style orange/jaune souvent utilisé pour "partiel"
                } 
                // Cas 3 : Erreur classique
                else {
                    hCard.className = "element-card incorrect";
                    msg.innerHTML = "Vous n'avez pas su placer correctement l'élément H. Prenez en compte sa masse atomique et ses propriétés, <strong>principalement</strong> les formules de ses corps composés.";
                    msg.className = "msg-error";
                }
            } else {
                // Si la carte est encore dans le pool
                msg.innerHTML = "Placez l'Hydrogène dans la grille.";
                msg.className = "msg-error";
            }
        }
    </script>
</body>
</html>