<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le génie de Mendeleïev - page 5</title>
    <link rel="stylesheet" href="style.css">
    <script src="data.js"></script>
    <script src="game.js"></script>
    <style>
        /* --- Styles spécifiques à cette grille --- */
        .mini-grid-container {
            display: grid;
            grid-template-columns: 140px repeat(3, 70px); 
            gap: 10px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: fit-content;
            /* Centre les slots horizontalement dans leurs colonnes */
            justify-items: center; 
            align-items: center;
        }

        .row-label {
            font-weight: bold;
            color: var(--primary-color);
            padding-right: 15px;
            font-size: 0.95rem;
            justify-self: end; /* Aligne le texte à droite */
        }

        .cards-pool {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            min-height: 80px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background-color: rgba(255,255,255,0.5);
            margin-bottom: 20px;
        }
        
        /* Feedback visuel (géré via game.js) */
        .cards-pool.drag-over, .slot.drag-over {
            background-color: rgba(0, 102, 153, 0.1);
            border-color: var(--primary-color);
        }
    </style>
</head>
<body>

    <header>
        <h2>Le génie de Mendeleïev - Exceptions aux règles</h2>
    </header>

    <div class="main-container">
        
        <section class="game-area">
            <div class="question-box intro-text">
                <p>Dans certains cas, Mendeleiev n'a pas hésité à <strong style="color: #FF0066;">adapter et contourner les règles</strong> qu'il s'était fixées pour construire son tableau.</p>
                <p>Étudiez par exemple le cas présenté ici de la même façon que Mendeleiev a été amené à le traiter.</p>
                <p class="consigne" style="font-weight: bold; color: var(--primary-color);">
                    Vous devez placer dans la cinquième ligne de l'extrait du tableau ci-dessous les trois éléments Sb, I et Te.
                </p>
            </div>

            <div class="cards-pool" id="card-pool" 
                 ondragover="commonAllowDrop(event); handleDragEnter(event)" 
                 ondragleave="handleDragLeave(event)" 
                 ondrop="handleCardDrop(event)">
            </div>

            <div class="mini-grid-container">
                <div class="row-label">-- 4ème ligne --</div>
                
                <div class="slot" id="slot-As"></div>
                <div class="slot" id="slot-Se"></div>
                <div class="slot" id="slot-Br"></div>

                <div class="row-label">-- 5ème ligne --</div>
                
                <div class="slot placeholder" id="zone-1" 
                     ondragover="commonAllowDrop(event); handleDragEnter(event)" 
                     ondragleave="handleDragLeave(event)" 
                     ondrop="handleCardDrop(event)"></div>
                
                <div class="slot placeholder" id="zone-2" 
                     ondragover="commonAllowDrop(event); handleDragEnter(event)" 
                     ondragleave="handleDragLeave(event)" 
                     ondrop="handleCardDrop(event)"></div>
                
                <div class="slot placeholder" id="zone-3" 
                     ondragover="commonAllowDrop(event); handleDragEnter(event)" 
                     ondragleave="handleDragLeave(event)" 
                     ondrop="handleCardDrop(event)"></div>
            </div>
        </section>

        <aside class="info-panel">
            <div class="info-header">
                <div id="info-symbole">--</div>
                <div id="info-nom">Survolez un élément</div>
            </div>
            <div class="info-item"><span class="info-label">Masse atomique (H=1)</span><span id="info-masse" class="info-value"></span></div>
            <div class="info-item"><span class="info-label">Formule corps simple</span><span id="info-formule" class="info-value"></span></div>
            <div class="info-item"><span class="info-label">Propriétés Physiques</span><span id="info-propPhy" class="info-value"></span></div>
            <div class="info-item"><span class="info-label">Propriétés Chimiques</span><span id="info-propChi" class="info-value"></span></div>
            <div class="info-item"><span class="info-label">Composés</span><span id="info-composes" class="info-value"></span></div>
        </aside>

    </div>

    <footer class="controls">
        <button class="btn" id="btn-verif" onclick="verifierReponse()">Valider</button>
        <div id="message-box"></div>
        <div class="nav-links">
            <a href="partie3_04.html" class="link-simple">&larr; Retour</a>
            <a href="partie3_06.html" id="btn-suite" class="btn" style="display:none;">Suite</a>
        </div>
    </footer>

    <script>
        // --- 1. DONNÉES SPÉCIFIQUES ---
        const updates = [
            { id: "Sb", nom: "ANTIMOINE", masse: "121,8", formule: "Sb", propPhy: "* Solide cassant", propChi: "* Dérivés toxiques", composes: "SbH<sub>3</sub>&nbsp;&nbsp;Sb<sub>2</sub>O<sub>5</sub>" },
            { id: "Te", nom: "TELLURE", masse: "127,6", formule: "Te", propPhy: "* Solide cristallin", propChi: "* Brûle dans le dioxygène", composes: "H<sub>2</sub>Te&nbsp;&nbsp;TeO<sub>2</sub>" },
            { id: "I", nom: "IODE", masse: "126,9", formule: "I<sub>2</sub>", propPhy: "* Vapeurs violettes", propChi: "* Réagit avec les métaux", composes: "NaI&nbsp;&nbsp;HI" },
            { id: "Se", nom: "SELENIUM", masse: "79,0", formule: "Se", propPhy: "* Photoconducteur", propChi: "* Dérivés très toxiques", composes: "H<sub>2</sub>Se&nbsp;&nbsp;SeO<sub>2</sub>" }
        ];
        
        updates.forEach(upd => {
            const idx = elementsData.findIndex(e => e.id === upd.id);
            if(idx !== -1) elementsData[idx] = upd;
            else elementsData.push(upd);
        });

        // --- 2. INITIALISATION ---
        
        // Remplissage des éléments statiques (Ligne 4)
        ['As', 'Se', 'Br'].forEach(id => {
            const container = document.getElementById('slot-' + id);
            const data = elementsData.find(e => e.id === id);
            if(data && container) {
                // On crée une carte non-draggable
                // Elle s'insère DANS le slot (le slot fait le contour gris, la carte le contour bleu)
                const card = createCard(data, false); 
                card.style.margin = "0"; // Évite les marges parasites dans la grille
                container.appendChild(card);
            }
        });

        // Création des cartes jouables dans la réserve
        const pool = document.getElementById('card-pool');
        ["Sb", "I", "Te"].forEach(id => {
            const data = elementsData.find(e => e.id === id);
            if(data) {
                pool.appendChild(createCard(data, true));
            }
        });

        // --- 3. VÉRIFICATION ---
        function verifierReponse() {
            const zone1 = document.getElementById('zone-1');
            const zone2 = document.getElementById('zone-2');
            const zone3 = document.getElementById('zone-3');
            const msgBox = document.getElementById('message-box');
            
            // Nettoyage des états visuels précédents
            document.querySelectorAll('.element-card').forEach(c => c.classList.remove('correct', 'incorrect'));

            let bonrep = 0;
            const check = (zone, expectedId) => {
                // zone.children[0] correspond à la carte déposée dans le slot
                if(zone.children.length > 0 && zone.children[0].id === expectedId) {
                    zone.children[0].classList.add('correct');
                    return 1;
                } else if (zone.children.length > 0) {
                    zone.children[0].classList.add('incorrect');
                }
                return 0;
            };

            bonrep += check(zone1, "Sb");
            bonrep += check(zone2, "Te"); // Inversion volontaire I / Te
            bonrep += check(zone3, "I");

            if (bonrep === 3) {
                msgBox.innerHTML = "Correct ! Mendeleiev a inversé Iode et Tellure pour respecter les propriétés chimiques, malgré leurs masses.";
                msgBox.className = "msg-success";
                document.getElementById('btn-verif').disabled = true;
                document.getElementById('btn-suite').style.display = "inline-block";
                
                // On fige le jeu
                document.querySelectorAll('.element-card').forEach(c => c.draggable = false);
            } else {
                msgBox.innerHTML = "Il y a des erreurs. Observez bien les propriétés chimiques (formules des composés) par rapport à la ligne du dessus.";
                msgBox.className = "msg-error";
            }
        }
    </script>
</body>
</html>