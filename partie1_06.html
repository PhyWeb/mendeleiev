<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction du Tableau</title>
    <link rel="stylesheet" href="style.css">
    <script src="data.js"></script>
</head>
<body>
    <header>
        <h2>Construction du Tableau</h2>
        <p>Disposez les éléments dans la grille (8 colonnes) en respectant masses croissantes et familles.</p>
    </header>

    <div class="main-container">
        <section class="game-area">
            <div class="card-pool" id="pool" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            <div class="periodic-grid" id="grid"></div>
        </section>

        <aside class="info-panel">
            <div class="info-header">
                <div id="info-symbole">--</div>
                <div id="info-nom">Survolez un élément</div>
            </div>
            
            <div class="info-item">
                <span class="info-label">Masse atomique (H=1)</span>
                <span id="info-masse" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Formule corps simple</span>
                <span id="info-formule" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Propriétés Physiques</span>
                <span id="info-propPhy" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Propriétés Chimiques</span>
                <span id="info-propChi" class="info-value"></span>
            </div>
            <div class="info-item">
                <span class="info-label">Composés</span>
                <span id="info-composes" class="info-value"></span>
            </div>
        </aside>
    </div>

    <footer class="controls">
        <button class="btn" onclick="validerTableau()">Valider le tableau</button>
        <div id="message-box"></div>
        <div class="nav-links">
             <a href="partie1_07.html" id="btn-suite" class="btn" style="display:none;">SUITE : Le cas de l'Hydrogène &rarr;</a>
        </div>
    </footer>

    <script>
        const pool = document.getElementById('pool');
        const grid = document.getElementById('grid');

        // Génération grille 4x8 (32 cases)
        for(let i=0; i<32; i++) {
            let slot = document.createElement('div');
            slot.className = 'slot';
            slot.setAttribute('data-index', i);
            slot.ondrop = drop; slot.ondragover = allowDrop;
            grid.appendChild(slot);
        }

        // Remplissage du pool (Sans Hydrogène pour l'instant si on suit la logique originale)
        elementsData.forEach(el => {
            if(el.id === "H") return; 

            let card = document.createElement('div');
            card.className = 'element-card';
            card.id = el.id;
            card.draggable = true;
            card.textContent = el.id;
            card.ondragstart = drag;
            card.onmouseover = () => showInfo(el.id);
            pool.appendChild(card);
        });

        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev) {
            ev.preventDefault();
            let el = document.getElementById(ev.dataTransfer.getData("text"));
            if(ev.target.classList.contains('slot')) {
                 if(ev.target.children.length === 0) ev.target.appendChild(el);
            } else if (ev.target.id === 'pool') pool.appendChild(el);
        }

        function showInfo(id) {
            const data = elementsData.find(e => e.id === id);
            if(data) {
                document.getElementById('info-symbole').textContent = id;
                document.getElementById('info-masse').textContent = data.masse;
                document.getElementById('info-formule').innerHTML = data.formule;
                document.getElementById('info-prop').innerHTML = data.propPhy; // Version courte pour cette page
            }
        }

        function validerTableau() {
            let errors = 0;
            // On valide seulement les cartes présentes dans la grille
            document.querySelectorAll('.element-card').forEach(card => {
                if(card.parentElement.classList.contains('slot')) {
                    let slotIdx = parseInt(card.parentElement.getAttribute('data-index'));
                    let data = elementsData.find(e => e.id === card.id);
                    if(data && slotIdx === data.pos) {
                        card.className = "element-card correct";
                    } else {
                        card.className = "element-card incorrect";
                        errors++;
                    }
                } else {
                    errors++; // Cartes restées dans le pool
                }
            });

            let msg = document.getElementById('message-box');
            if(errors === 0 && pool.children.length === 0) {
                msg.innerHTML = "Bravo ! Tableau reconstruit."; msg.className = "msg-success";
                document.getElementById('btn-suite').style.display = 'inline-block';
            } else {
                msg.innerHTML = "Tableau incomplet ou erreurs (en rouge)."; msg.className = "msg-error";
            }
        }
    </script>
</body>
</html>